# Faiz Essa
# GDELT Tone Data difference-in-differences
# April 30th, 2023

#### SETUP ####

rm(list=ls())

# importing packages 
library(tidyverse)
library(did)

# import data
gdelt_tone_panel <- read_csv("Data/GDELT/gdelt_tone_panel.csv")

# adding logs
gdelt_tone_panel <- gdelt_tone_panel %>%
  mutate(zscore = c(scale(AvgGovTone))) 

#### EXECUTING DIFF-IN-DIFFS ####

estimates <- att_gt(yname = "zscore",
                    tname = "time",
                    idname = "Actor1Geo_ADM2Code",
                    gname = "group",
                    xformla = ~1,
                    data = gdelt_tone_panel,
                    allow_unbalanced_panel = TRUE,
                    bstrap = TRUE,
                    clustervars = c("Actor1Geo_ADM2Code"))
# saving estimates
write_rds(estimates, "/Users/faizessa/Documents/Data/GDELTToneDiD/zscore.rds")

